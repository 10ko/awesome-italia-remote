name: Readme generator

on:
  push:
    branches: [ main ]
    paths: 
    - 'src/data.json'
    - '.github/workflows/readme-generator.yml'

jobs:
  build:
    runs-on: ubuntu-latest
    environment: main
    steps:
    - uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.17

    - name: Generate
      run: |
        cd ./src
        go run .
    
    - name: Git Push
      run: |
        git config --global user.name 'Alessandro Marino'
        git config --global user.email '${{ secrets.EMAIL }}'
        git add README.md
        git commit -m "Automatic README.md update" || echo "No changes to commit"
        git push origin generator
    
